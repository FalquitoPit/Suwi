package com.opencsv;

import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;
import org.jsoup.nodes.Element;
import org.jsoup.select.Elements;
import com.opencsv.CSVWriter;
import java.io.FileWriter;
import java.io.IOException;

public class AmazonScraper {

    public static void main(String[] args) throws IOException {
        String url = "https://www.amazon.com/s?k=juegos"; // URL de la página de resultados de Amazon

        try {
            Document document = Jsoup.connect(url).get(); // Realiza la conexión y obtiene el HTML de la página

            Elements productElements = document.select("div[data-component-type='s-search-result']"); // Selecciona los elementos que contienen los productos

            
            String csvFile = "productos_amazon.csv";

            try (CSVWriter writer = new CSVWriter(new FileWriter(csvFile))) {
                
                writer.writeNext(new String[]{"Título", "Precio (EUR)"});

                for (Element productElement : productElements) {
                    
                    Element titleElement = productElement.selectFirst("h2 a");
                    String title = titleElement.text();

                    Element priceElement = productElement.selectFirst(".a-offscreen");
                    String price = priceElement.text();

                    
                    writer.writeNext(new String[]{title, price});
                }

                System.out.println("El archivo " + csvFile + " se ha creado correctamente.");
            }
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}